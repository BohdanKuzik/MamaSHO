{% load static thumbnail %}
<a href="{% url 'product_detail' pk=product.pk %}" class="card product-card bg-base-100 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 block cursor-pointer group flex flex-col h-full">
    <figure class="px-2 sm:px-3 pt-2 sm:pt-3 pb-0 flex-shrink-0">
            {% if product.image %}
            {% thumbnail product.image "600x800" crop="center" upscale=False as card_image %}
            <img src="{{ card_image.url }}"
                 alt="{{ product.name }}"
                 loading="lazy"
                 decoding="async"
                 width="{{ card_image.width }}"
                 height="{{ card_image.height }}"
                 class="rounded-lg h-48 sm:h-56 md:h-64 lg:h-80 w-full object-cover group-hover:opacity-90 transition-opacity duration-200"
                 onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\'%3E%3Cpath fill=\'%23e5e7eb\' d=\'M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\'/%3E%3C/svg%3E';">
            {% endthumbnail %}
            {% else %}
            <div class="bg-base-200 rounded-lg h-48 sm:h-56 md:h-64 lg:h-80 w-full flex items-center justify-center group-hover:bg-base-300 transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 sm:h-20 sm:w-20 md:h-24 md:w-24 text-base-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                </div>
            {% endif %}
    </figure>
    <div class="card-body p-2 sm:p-3 flex-1 flex flex-col">
        <h2 class="card-title text-xs sm:text-sm md:text-base break-words mb-1 line-clamp-2" style="word-break: break-word; overflow-wrap: anywhere;">
            {{ product.name }}
        </h2>
        <div class="flex items-center gap-1.5 mb-1">
            {% if product.stock < 10 %}
                <div class="badge badge-warning gap-0.5 text-[10px] sm:text-xs py-0.5 px-1.5 sm:px-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-2.5 w-2.5 sm:h-3 sm:w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <span class="text-[10px] sm:text-xs">Мало на складі</span>
                </div>
            {% else %}
                <div class="badge badge-success gap-0.5 text-[10px] sm:text-xs py-0.5 px-1.5 sm:px-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-2.5 w-2.5 sm:h-3 sm:w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span class="text-[10px] sm:text-xs">В наявності</span>
                </div>
            {% endif %}
        </div>
        <p class="text-[10px] sm:text-xs text-base-content/60 mb-1 line-clamp-1">{{ product.category }}</p>
        <div class="flex items-center justify-between mb-1.5 mt-auto">
            <div>
                <p class="text-sm sm:text-base md:text-lg font-bold price-golden">{{ product.price }}₴</p>
            </div>
        </div>
        <div class="card-actions justify-between mt-auto pt-1" onclick="event.stopPropagation();">
            {% if request.user.is_staff or request.user.is_superuser %}
            <button class="btn btn-outline btn-error btn-sm sm:btn-md"
                    hx-confirm="Підтвердити?"
                    hx-target="closest .product-card"
                    hx-swap="outerHTML"
                    hx-delete="{% url 'dynamic-delete' pk=product.pk %}"
                    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                    onclick="event.stopPropagation(); event.preventDefault();">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                <span class="hidden sm:inline">Видалити</span>
            </button>
            {% endif %}
            <div class="flex gap-2 flex-1 justify-end">
                <button type="button" 
                        class="btn btn-sm sm:btn-md basket-add-btn flex-1 sm:flex-none {% if not product.available or product.stock == 0 %}btn-disabled opacity-50{% endif %}"
                        {% if product.available and product.stock > 0 %}
                        hx-post="{% url 'basket_add' product_id=product.pk %}"
                        hx-vals='{"quantity": "1"}'
                        hx-target="body"
                        hx-swap="none"
                        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                        hx-trigger="click"
                        hx-on::after-request="if (event.detail.xhr.status === 200) { window.dispatchEvent(new CustomEvent('basket-updated')); }"
                        {% else %}
                        disabled
                        {% endif %}
                        onclick="event.stopPropagation(); event.preventDefault(); return false;">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span class="text-xs sm:text-sm font-semibold">
                        {% if product.available and product.stock > 0 %}
                            В кошик
                        {% elif product.stock == 0 %}
                            Немає
                        {% else %}
                            Недоступний
                        {% endif %}
                    </span>
                </button>
            </div>
        </div>
    </div>
</a>

